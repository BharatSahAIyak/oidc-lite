{
  "variables": {
    "apiKeyValue": "master",
    "jwksKeyId": "#{UUID()}",
    "applicationId": "myminioadmin",
    "clientSecret": "minio-secret-key-change-me",
    "tenantId": "minio-tenant",
    "roleId1": "userRoleId",
    "roleId2": "adminRoleId",
    "groupId2": "agroup",
    "groupId1": "ugroup",
    "adminUsername": "admin",
    "adminPassword": "adminPassword12#",
    "userEmail2": "adminuser@email.com",
    "userEmail1": "user@email.com",
    "userPassword": "userPassword12#"
  },
  "apiKey": {
    "key": "#{apiKeyValue}",
    "description": "Unrestricted API key"
  },
  "requests": [
    {
      "method": "POST",
      "url": "/admin",
      "body": {
        "password": "#{adminPassword}",
        "username": "#{adminUsername}"
      }
    },
    {
      "method": "POST",
      "url": "/key/generate/#{jwksKeyId}",
      "headers": {
        "x-stencil-tenantid": "#{tenantId}",
        "authorization": "#{apiKeyValue}"
      },
      "body": {
        "key": {
          "algorithm": "RS256",
          "issuer": "Stencil Service",
          "name": "First jwks"
        }
      }
    },
    {
      "method": "POST",
      "url": "/tenant/#{tenantId}",
      "headers": {
        "x-stencil-tenantid": "#{tenantId}",
        "authorization": "#{apiKeyValue}"
      },
      "body": {
        "data": {
          "name": "First tenant",
          "jwtConfiguration": {
            "accessTokenSigningKeysID": "#{jwksKeyId}",
            "refreshTokenTimeToLiveInMinutes": 3600,
            "timeToLiveInSeconds": 60,
            "idTokenSigningKeysID": "#{jwksKeyId}"
          }
        }
      }
    },
    {
      "method": "POST",
      "url": "/application/#{applicationId}",
      "headers": {
        "x-stencil-tenantid": "#{tenantId}",
        "authorization": "#{apiKeyValue}"
      },
      "body": {
        "data": {
          "active": true,
          "name": "First Stencil application",
          "scopes": [
            {
              "name": "offline_access",
              "defaultConsentDetail": "Required for getting access token",
              "defaultConsentMessage": "Perform actions from your behalf",
              "required": false
            },
            {
              "name": "profile",
              "defaultConsentDetail": "Your username, firstname and lastname will be shared",
              "defaultConsentMessage": "Access to your profile data",
              "required": false
            },
            {
              "name": "openid",
              "defaultConsentDetail": "Openid",
              "defaultConsentMessage": "Access to your profile data",
              "required": false
            },
            {
              "name": "email",
              "defaultConsentDetail": "Your email will be shared",
              "defaultConsentMessage": "Access to your email",
              "required": false
            }
          ],
          "roles": [
            {
              "name": "urn:myminioadmin:policy:'readwrite'",
              "description": "This is user role",
              "isDefault": true,
              "isSuperRole": false,
              "id": "#{roleId1}"
            },
            {
              "name": "urn:myminioadmin:policy:['consoleAdmin','readwrite']",
              "description": "This is special role assigned to admin users",
              "isDefault": false,
              "isSuperRole": true,
              "id": "#{roleId2}"
            }
          ],
          "oauthConfiguration": {
            "authorizedOriginURLs": [
              "*",
              "https://strong-chairs-fall.loca.lt",
              "https://jl4spt7t-3000.inc1.devtunnels.ms/"
            ],
            "authorizedRedirectURLs": [
              "http://localhost:9001/oauth_callback",
              "http://192.168.233.157:9001/oauth_callback",
              "http://localhost:4180/oauth2/callback",
              "http://localhost:3001",
              "http://localhost:9001",
              "http://localhost:3001/callback",
              "http://192.168.250.157:9001/oauth_callback"
            ],
            "clientSecret": "#{clientSecret}",
            "enabledGrants": ["authorization_code", "refresh_token"],
            "logoutURL": "http://localhost:3001/logout",
            "enablePKCE": false,
            "skipConsentScreen": true
          }
        }
      }
    },
    {
      "method": "POST",
      "url": "/group/#{groupId2}",
      "headers": {
        "authorization": "#{apiKeyValue}",
        "x-stencil-tenantid": "#{tenantId}"
      },
      "body": {
        "group": {
          "name": "Admin group",
          "roleIDs": ["#{roleId2}"]
        }
      }
    },
    {
      "method": "POST",
      "url": "/group/#{groupId1}",
      "headers": {
        "authorization": "#{apiKeyValue}",
        "x-stencil-tenantid": "#{tenantId}"
      },
      "body": {
        "group": {
          "name": "user group",
          "roleIDs": ["#{roleId1}"]
        }
      }
    },
    {
      "method": "POST",
      "url": "/user/registration/combined/",
      "headers": {
        "x-stencil-tenantid": "#{tenantId}",
        "authorization": "#{apiKeyValue}"
      },
      "body": {
        "data": {
          "userInfo": {
            "active": true,
            "applicationId": "#{applicationId}",
            "membership": ["#{groupId2}"],
            "userData": {
              "username": "AdminUser",
              "password": "#{userPassword}"
            },
            "email": "#{userEmail2}"
          },
          "registrationInfo": {
            "generateAuthenticationToken": true,
            "applicationId": "#{applicationId}"
          }
        }
      }
    },
    {
      "method": "POST",
      "url": "/user/registration/combined/",
      "headers": {
        "x-stencil-tenantid": "#{tenantId}",
        "authorization": "#{apiKeyValue}"
      },
      "body": {
        "data": {
          "userInfo": {
            "active": true,
            "applicationId": "#{applicationId}",
            "membership": ["#{groupId1}"],
            "userData": {
              "username": "normalUser",
              "password": "#{userPassword}"
            },
            "email": "#{userEmail1}"
          },
          "registrationInfo": {
            "generateAuthenticationToken": true,
            "applicationId": "#{applicationId}"
          }
        }
      }
    }
  ]
}
